---
title: "02 - Visualization of simulation results"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Exploring SWATplusR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: literature.bib
link-citations: yes
csl: copernicus.csl
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## R packages

R offers a large variety of methods and packages for visualization. Most plotting methods are however static, which makes sense for publishing results. For model diagnosis, however, interactive plotting can greatly support the modeler. This chapter gives a brief overview of plotting methods that can support you in analyzing your simulation results. 
A great R package to visualize time series data and offer options such as zooming is `dygraphs`. It works with `xts` time series data and can support you in comparing the simulated time series (e.g. discharge, in-stream nitrogen etc.) with observation data. `ggplot2` is a very versatile package for data visualization, that you have seen already several times in the previous chapters. `plotly` offers easy ways to make ggplots more interactive. To visualize spatial data and have functionalities that are usually provided by GIS software `mapview` provides a great alternative. It is based on `leaflet` that most of us have most likely already seen in action on web pages with interactive maps (and maybe did not realize that this is a leaflet map and we can also produce something similar with R easily).

### Package installation

If you do not have installed any of the required R package, follow the instructions for the respective R package. All of the required R packages are available from CRAN and can be installed with the following commands:
```{r, eval=FALSE}
install.packages("dplyr")
install.packages("dygraphs")
install.packages("ggplot2")
install.packages("lubridate")
install.packages("mapview")
install.packages("purrr")
install.packages("plotly")
install.packages("tibble")
install.packages("tidyr")
install.packages("xts")
```

### Loading R packages
```{r, message=FALSE, warning=FALSE}
library(SWATplusR)
library(dplyr)
library(dygraphs)
library(lubridate)
library(tibble)
library(tidyr)
library(purrr)
library(ggplot2)
library(xts)
```

## Loading demo data

The optimization example uses the SWAT+ demo project available from `SWATplusR`. The demo project is a very simple model setups of a head watershed of the Little River Experimental Watershed [LREW; @Bosch2007]. You can load the to your hard drive as follows:

```{r, eval=FALSE}
# The path where the SWAT demo project will be written
demo_path <- "Define:/your/path"

# Loading the SWAT+ demo project on your hard drive
path_plus <- load_demo(dataset = "project",
                       version = "plus",
                       path = demo_path, 
                       revision = 57)
```
```{r, echo=FALSE}
path_plus <- "C:/swat_demo/swatplus_rev57_demo"
```
`SWATplusR` also provides observation data of daily discharge records at the main outlet of the demo for the time period 1968-01-01 until 2012-12-31. We will use the observation data to compare the discharge simulations with observed values:

```{r}
q_obs <- load_demo(dataset = "observation")
```

## Parameter sampling
For the sampling example we will use 7 SWAT model parameters that are frequently calibrated for discharge. Below we create a `tibble` [@Mueller2019] that provides the parameter boundaries for the 7 parameters. We name the parameters using the specific syntax that is requested by the `run_swat*()` functions (see the [Get started](https://chrisschuerz.github.io/SWATplusR/articles/SWATplusR.html#model-parameter-alteration) section on 'Model parameter alteration' to learn more on parameter names):

```{r}
par_bound <- tibble("cn2.hru | change = abschg" = c(-15, 10),
                    "lat_ttime.hru | change = absval" = c(0.5, 50),
                    "lat_len.hru | change = absval" = c(10, 100),
                    "k.sol | change = pctchg" = c(-50, 50),
                    "z.sol | change = pctchg" = c(-50, 50),
                    "esco.hru | change = absval" = c(0, 1),
                    "epco.hru | change = absval" = c(0, 1))
```

## References
